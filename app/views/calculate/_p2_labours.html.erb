<tr>
	<th><%= link_to_function "Travail du sol", "$('list_labours').toggle();" %></th>
	<td></td>
	<% if @show[:date_surface] %> 
		<td></td>	
		<td></td>
	<% end %>
	<td class="saison"></td>
	<td class="saison"></td>
	<% td_number_after_saison(@colonnes.length, @show[:cout_ha], @show[:cout_total]).times do %>
		<td></td>
	<% end %>
</tr>
<% unless (((@labours.class == Array) && @labours.size == 0) || (@labours.nil?)) %>
	<% if @show[:labours] %>
		<% @labours.each do |labour| %>
			<% datas = @test.res.get_saison_line_datas(@test.sid, :labours, labour.id) %>
			<tr>
				<td class='left'><strong><%= datas[:category_name] %></strong></td>
				<td class='left'>
					<%= link_popup_labour(datas[:id]) %> 
					<% if datas[:factures_assoc] %>
						*
					<% end %>
				</td>
				<% if @show[:date_surface] %> 
					<td class='left'><%= datas[:date].to_s :dmy %></td>	
					<td class='left'>
						<%= datas[:parcelles_length] %> p - 
						<%= datas[:surface_total] %> ha
					</td>
				<% end %> 
				<td class="saison"><%= @test.res.get_saison_line(@test.sid, :labours, :all, labour.id, :ha).display %></td>
				<td class="saison"><%= @test.res.get_saison_line(@test.sid, :labours, :all, labour.id, :total).display %></td>
			<% rang = 0 %>
			<% @colonnes.each do |colonne| %>
				<% rang += 1 %>
				<% cout_ha = @test.res.get_line(@test.sid, @test.c, colonne.id, :labours, :all, labour.id, :ha).display %>
				<% cout_total = @test.res.get_line(@test.sid, @test.c, colonne.id, :labours, :all, labour.id, :total).display %>
				<% if @show[:cout_ha] %>
					<td class="<%= odd(rang) %>"><%=h cout_ha %></td>
				<% end %>
				<% if @show[:cout_total] %>
					<td class="<%= odd(rang) %>"><%=h cout_total %></td>
				<% end %>
			<% end %>
			</tr>
		<% end %>
	<% end %>
	
	<% if @show[:pulves] %>	
		<% @pulves.each do |pulve| %>
			<% datas = @test.res.get_saison_line_datas(@test.sid, :pulves, pulve.id) %>
			<tr>
				<td class='left'>Traitement</strong></td>
				<td class='left'><%= link_popup_pulve(datas) %></td>
				<% if @show[:date_surface] %> 
					<td class="date"><%= datas[:date].to_s :dmy %></td>	
					<td class='left'>
						<%= datas[:parcelles_length] %> p - 
						<%= datas[:sum_surfaces].display %> ha
					</td>
				<% end %> 
				<td class="saison"><%= @test.res.get_saison_line(@test.sid, :pulves, :all, pulve.id, :ha).display %></td>
				<td class="saison"><%= @test.res.get_saison_line(@test.sid, :pulves, :all, pulve.id, :total).display %></td>
	
				<% rang = 0 %>
				<% @colonnes.each do |colonne| %>
					<% rang += 1 %>
					<% cout_ha = @test.res.get_line(@test.sid, @test.c, colonne.id, :pulves, :all, pulve.id, :ha).display %>
					<% cout_total = @test.res.get_line(@test.sid, @test.c, colonne.id, :pulves, :all, pulve.id, :total).display %>
					<% if @show[:cout_ha] %>
						<td class="<%= odd(rang) %>"><%=h cout_ha %></td>
					<% end %>
					<% if @show[:cout_total] %>
						<td class="<%= odd(rang) %>"><%=h cout_total %></td>
					<% end %>
				<% end %>
			</tr>
		<% end %>
	<% end %>

	<!--Sous Total Pulve "category" (desherbant, fongicide,...) -->
	<% if @show[:total_cat] %>
		<tr>
			<td>Total par Categorie</td>
			<td></td>	
			<% if @show[:date_surface] %> 
				<td></td>	
				<td></td>
			<% end %>
			<td class="saison"></td>
			<td class="saison"></td>
			<% td_number_after_saison(@colonnes.length, @show[:cout_ha], @show[:cout_total]).times do %>
				<td></td>
			<% end %>
		</tr>	

		<!-- Categories de Labours et categorie "Prestation Traitements"-->
		<!-- Categories de Labours-->
		<% for cat in @labour_categories %>
			<tr class="subtotal">
				<td class="left">Prestation</td>
				<td class="left"><b><%= cat.name %></b></td>
				<% if @show[:date_surface] %> 
					<td></td>	
					<td></td>
				<% end %>
				<td class="saison"><%= @test.res.get_saison_line(@test.sid, :labours, :category, cat.id, :ha).display %></td>
				<td class="saison"><%= @test.res.get_saison_line(@test.sid, :labours, :category, cat.id, :total).display %></td>
				<% rang = 0 %>
				<% @colonnes.each do |colonne| %>
					<% rang += 1 %>
					<% cout_ha = @test.res.get_line(@test.sid, @test.c, colonne.id, :labours, :category, cat.id, :ha).display %>
					<% cout_total = @test.res.get_line(@test.sid, @test.c, colonne.id, :labours, :category, cat.id, :total).display %>
					<% if @show[:cout_ha] %>
						<td class="<%= odd(rang) %>"><%=h cout_ha %></td>
					<% end %>
					<% if @show[:cout_total] %>
						<td class="<%= odd(rang) %>"><%=h cout_total %></td>
					<% end %>
				<% end %>
			</tr>
		<% end %>
		<!-- Categorie "Prestation Traitements"-->
		<tr class="subtotal">
			<td class=left>Prestation</td>
			<td class=left><b>Traitements Phyto<b></td>
			<% if @show[:date_surface] %> 
				<td></td>
				<td></td>
			<% end %> 
			<td class="saison"><%= @test.res.get_other_line_for_saison(@test.sid, :resultats, :total_pulves, :ha).display %></td>
			<td class="saison"><%= @test.res.get_other_line_for_saison(@test.sid, :resultats, :total_pulves, :total).display %></td>	
			<% rang = 0 %>
			<% @colonnes.each do |colonne| %>
				<% rang += 1 %>
				<% cout_ha = @test.res.get_other_line(@test.sid, @test.c, colonne.id, :resultats, :total_pulves, :ha).display %>
				<% cout_total = @test.res.get_other_line(@test.sid, @test.c, colonne.id, :resultats, :total_pulves, :total).display %>
				<% if @show[:cout_ha] %>
					<td class="<%= odd(rang) %>_subtotal"><%=h cout_ha %></td>
				<% end %>
				<% if @show[:cout_total] %>
					<td class="<%= odd(rang) %>_subtotal"><%=h cout_total %></td>
				<% end %>
			<% end %>
		</tr>
		
<!-- total prestation = total Labours + total Pulves -->
	<% total_presta_saison_ha = (@test.res.get_other_line_for_saison(@test.sid, :resultats, :total_labours, :ha) +
								@test.res.get_other_line_for_saison(@test.sid, :resultats, :total_pulves, :ha))
	%>
	<% total_presta_saison = (@test.res.get_other_line_for_saison(@test.sid, :resultats, :total_labours, :total) +
								@test.res.get_other_line_for_saison(@test.sid, :resultats, :total_pulves, :total))
	%>
	<tr class="total">
		<td id="nom">Total Prestations:	</td>
		<td></td>
		<% if @show[:date_surface] %> 
			<td></td>	
			<td></td>
		<% end %>
		<td class="saison"><%= total_presta_saison_ha.display %></td>
		<td class="saison"><%= total_presta_saison.display %></td>	
		<% rang = 0 %>
		<% @colonnes.each do |colonne| %>
			<% cout_ha = (@test.res.get_other_line(@test.sid, @test.c, colonne.id, :resultats, :total_labours, :ha) +
						  @test.res.get_other_line(@test.sid, @test.c, colonne.id, :resultats, :total_pulves, :ha))
			%>
			<% cout_total = (@test.res.get_other_line(@test.sid, @test.c, colonne.id, :resultats, :total_labours, :total) +
							 @test.res.get_other_line(@test.sid, @test.c, colonne.id, :resultats, :total_pulves, :total))
			%>
			<% rang += 1 %>
			<% if @show[:cout_ha] %>
				<td class="<%= odd(rang) %>_subtotal"><%=h cout_ha.display %></td>
			<% end %>
			<% if @show[:cout_total] %>
				<td class="<%= odd(rang) %>_subtotal"><%=h cout_total.display %></td>
			<% end %>
		<% end %>
	</tr>

	<% end %>
<% end %>
<tr><td></td></tr>
