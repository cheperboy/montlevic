
<%- if @facture.protofactures.length > 0 -%>
<div id="show_table">
	<h3>Produits</h3>
	<table class=table_data>
		<tr class=bold>
			<th colspan=3></th>
			<th colspan=2 class=center>Acheté</th>
			<th colspan=2 class=center>Consommé</th>
			<th></th>
		</tr>
		<tr class=bold>
			<th>Categorie</th>
			<th>Nom</th>
			<th>Prix</th>
			<th>Quantité</th>
			<th>Cout</th>
			<th>Quantité</th>
			<th>Cout</th>
			<th></th>
		</tr>
	<%- total_prix = 0 -%>
	<%- @facture.protofactures.each do |protofacture| -%>
		<%- total_prix += protofacture.quantite * protofacture.prix_unit -%>
		<tr>
			<td><%=h protofacture.produit.category.name %></td>
			<td><%=h protofacture.produit.name %></td>
			<td class=right><%=h (protofacture.prix_unit).display(2) %> €/<%=h protofacture.produit.unit %></td>
			<td class=right><%=h protofacture.quantite.display %> <%=h protofacture.produit.unit %></td>
			<td class=right><%=h (protofacture.quantite * protofacture.prix_unit).display %> <%= euro %></td>
			<td class=right><%=h protofacture.get_used.display %> <%=h protofacture.produit.unit %></td>
			<td class=right><%=h (protofacture.get_used * protofacture.prix_unit).display %> <%= euro %></td>
			<td><%= link_to image_tag('img-voir.png'), :controller => "produits", :action => "show", :id => protofacture.produit %></td>
		</tr>
	<%- end -%>
		<tr class=bold>
			<td>Total</td>
			<td></td>
			<td></td>
			<td></td>
			<td class=right><%=h total_prix.display() %> <%= euro %></td>
			<td class=right></td>
			<td class=right><%=h @facture.sum_putoproduits_used.display() %> <%= euro %></td>
			<td></td>
		</tr>
	</table>
</div>
<%- end -%>

<% if (@facture.labours.count > 0) %>
<div id="show_table">
	<h3>Labours</h3>
	<table class=table_data>
		<tr class=bold>
		    <td><b>Labour</b></td>
		    <td><b>date</b></td>
		    <td><b>cout</b></td>
		    <td><b>contribution</b></td>
		</tr>
	<% @facture.labtofactures.each do |labtofacture| %>
		<tr>
			<td><%= link_to labtofacture.labour.name, labour_path(labtofacture.labour) %></td>
			<td><%=h labtofacture.labour.print_date %></td>
			<td><%=h labtofacture.labour.get_cout_total.display %></td>
			<td><%=h labtofacture.value.display %></td>
		</tr>
	<% end %>
		<tr>
			<td></td>
			<td></td>
			<td class=bold>Somme :</td>
			<td class=bold><%=h @facture.sum_labours.display %></td>
		</tr>
	</table>
</div>
<%- end -%>

<% if (@facture.pulves.count > 0) %>
<div id="show_table">
	<h3>Traitements</h3>
	<table class=table_data>
	  <tr class=table_data>
	    <td><b>Pulve</b></td>
	    <td><b>date</b></td>
	    <td><b>cout</b></td>
	    <td><b>contribution</b></td>
	  </tr>
	<% @facture.putofactures.each do |putofacture| %>
	  <tr>
	    <td><%= link_to putofacture.pulve.name, pulve_path(putofacture.pulve) %></td>
	    <td class=right><%=h putofacture.pulve.print_date %></td>
	    <td class=right><%=h putofacture.pulve.get_cout_total.display %></td>
	    <td class=right><%=h putofacture.value.display %></td>
	  </tr>
	<% end %>
	  <tr>
	    <td></td>
	    <td></td>
	    <td class=bold>Somme :</td>
	    <td class=right><%=h @facture.sum_pulves %></td>
	  </tr>
	</table>
</div>
<% end %>


